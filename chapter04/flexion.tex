\subsubsection{\Glspl{flexion-image}}\label{flexion-image-section}

The local shape of an object that is sampled by a depth sensor is characterized by its normalized surface normal.
A surface normal is a vector perpendicular to the surface of the object.
This characterization builds the foundation of the \Gls{flexion-image} and its inspiration, too.

Each measured pixel is backprojected to camera coordinates, scaling the point in spherical coordinates with its measured range, as first step.
Approximating the normal for a measured surface point $\mathbf{P_{i,j}}$ is possible using the cross product of its neighbours connecting vectors.
The point relationship is visualized in Figure~\ref{fig:flexion_normals_plane}.
\begin{figure}[H]
    \begin{subfigure}[t]{0.49\linewidth}
        \centering
        \scalebox{1.0}{%
        \input{chapter04/img/flexion_tikz.tex}
        }
        \caption{The normals for a point $\mathbf{P_{i,j}}$ can be estimated its diagonal or horizontal and vertical neighbours.}\label{fig:flexion_normals_plane}
    \end{subfigure}
    \begin{subfigure}[t]{0.49\linewidth}
        \centering
        \input{chapter04/img/flexion_perspective.tex}
        \caption{The estimated normals span an angle depending on the local shape of the surface measured by the depth sensors.}\label{fig:flexion_space}
    \end{subfigure}
    \caption[Schematic Representation of Flexion]{This figure demonstrates how flexed surfaces have different normals for diagonal and non-diagonal estimation. This difference is utilized as measure for flexion.}%
    \label{fig:flexion-image-scetched}
\end{figure}
Using the diagonal and vertical neighbouring points (blue) results a different normal than the diagonal neighbours (orange).
As Figure~\ref{fig:flexion_space} demonstrates, both normals span an angle.
\begin{equation}
\begin{aligned}
    \vec{n_1} &= \frac{\vec{P_{i,j-1}} - \vec{P_{i,j+1}}}{\lnorm{\vec{P_{i,j-1}} - \vec{P_{i,j+1}}}}
                \times \frac{\vec{P_{i-1,j}} - \vec{P_{i+1,j}}}{\lnorm{\vec{P_{i-1,j}} - \vec{P_{i+1,j}}}} \\
    \vec{n_2} &= \frac{\vec{P_{i-1,j-1}} - \vec{P_{i+1,j+1}}}{\lnorm{\vec{P_{i-1,j-1}} - \vec{P_{i+1,j+1}}}}
                \times \frac{\vec{P_{i-1,j+1}} - \vec{P_{i+1,j-1}}}{\lnorm{\vec{P_{i-1,j+1}} - \vec{P_{i+1,j-1}}}}
    \label{eq:flexion_normals}
\end{aligned}
\end{equation}
Note, that both normals $\vec{n_1}$ and $\vec{n_2}$ are not unit length, but only the direction vector between the neighbouring points of $\mathbf{P_{i,j}}$.
Finally, the Flexion $\mathcal{F}$ of point $\mathbf{P_{i,j}}$ is defined as
\begin{align}
    \mathcal{F} &= \abs{\vec{n_1} \cdotp \vec{n_2}}
\end{align}
Because $\lnorm{\vec{n_1}},\lnorm{\vec{n_2}} \in [0,1]$ the value of is bound to $\mathcal{F} \in [0, 1]$.
Creating the final image requires a linear scaling to the desired output image depth using Equation~\ref{eq:linear_scaling}.

Figure~\ref{fig:flexion_images} visualizes the \Gls{flexion-image} for the same camera positions as for the other feature images.
\begin{figure}[H]
    \begin{subfigure}[t]{0.32\textwidth}
        \includegraphics[width=\linewidth]{chapter04/img/flexion-0001.png}
        \caption{}
    \end{subfigure}
    \begin{subfigure}[t]{0.32\textwidth}
        \includegraphics[width=\linewidth]{chapter04/img/flexion-0030.png}
        \caption{}
    \end{subfigure}
    \begin{subfigure}[t]{0.32\textwidth}
        \includegraphics[width=\linewidth]{chapter04/img/flexion-0210.png}
        \caption{}
    \end{subfigure}
    \caption{These figures demonstrate the characteristical look of the \Glspl{flexion-image}. Its appearence is very plastic and the shading effects give a good feel for depth. The conversion is rotation invariant.}\label{fig:flexion_images}
\end{figure}

\subsubsection*{Characteristics}

The \gls{flexion-image} is rotation invariant.
Rotation of either an object or the camera does not change the difference between the two normal approximations.
A flat surface has an almost constant shading, because the normal approximation results in the same vector directions.
Flat surfaces not perpendicular to the camera plane have non-constant shading with the brightness reduced the further the surface patch is appart from the camera center.
This effect is caused by the perspective transformation.
The length of the normal vectors reduces with the distance to the camera, because the diagonals gets smaller, as Figure~\ref{fig:flexion_angle_decrease} demonstrates.
\begin{figure}[H]
    \input{chapter04/img/flexion_angle_decrease}
    \caption{The angle between the diagonals decreases with increasing distance from the camera center. This results in short normals.}\label{fig:flexion_angle_decrease}
\end{figure}
The origin is the nature of the cross product is maximal if both vectors are perpendicular.
\begin{equation*}
    \lnorm{\vec{v_1} \times \vec{v_2}} = \lnorm{\vec{v_1}} \lnorm{\vec{v_2}} \sin \angle(\vec{v_1}, \vec{v_2})
\end{equation*}
The lack of normalization in Equation~\ref{eq:flexion_normals} propagates this effect through to the scalar product.
\begin{equation*}
    \vec{v_1} \cdot \vec{v_2} = \lnorm{\vec{v_1}} \lnorm{\vec{v_2}} \cos \angle(\vec{v_1}, \vec{v_2})
\end{equation*}
This shading effect gives the \gls{flexion-image} its plastic look and helps to develop the feeling for the geometric constellations.
